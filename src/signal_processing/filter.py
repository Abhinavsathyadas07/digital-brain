"""\nSignal Filtering Module\nImplements bandpass filters for theta/gamma extraction and artifact removal\n"""\n\nimport numpy as np\nfrom scipy import signal\nfrom typing import Tuple\n\n\nclass NeuralFilter:\n    """\n    Digital filters for neural signal preprocessing.\n    Extracts theta (4-12 Hz) and gamma (30-100 Hz) frequency bands.\n    """\n    \n    def __init__(self, sampling_rate: int = 1000):\n        """\n        Initialize filter with sampling rate.\n        \n        Args:\n            sampling_rate: Hz, must match signal acquisition rate\n        """\n        self.fs = sampling_rate\n        \n    def bandpass_filter(self, data: np.ndarray, lowcut: float, \n                       highcut: float, order: int = 4) -> np.ndarray:\n        """\n        Apply Butterworth bandpass filter.\n        \n        Args:\n            data: Input signal\n            lowcut: Low frequency cutoff (Hz)\n            highcut: High frequency cutoff (Hz)\n            order: Filter order (default 4)\n            \n        Returns:\n            Filtered signal\n        """\n        nyquist = 0.5 * self.fs\n        low = lowcut / nyquist\n        high = highcut / nyquist\n        b, a = signal.butter(order, [low, high], btype='band')\n        filtered = signal.filtfilt(b, a, data)\n        return filtered\n    \n    def extract_theta(self, data: np.ndarray) -> np.ndarray:\n        """Extract theta rhythm (4-12 Hz) for memory encoding analysis."""\n        return self.bandpass_filter(data, lowcut=4.0, highcut=12.0)\n    \n    def extract_gamma(self, data: np.ndarray) -> np.ndarray:\n        """Extract gamma rhythm (30-100 Hz) for memory retrieval analysis."""\n        return self.bandpass_filter(data, lowcut=30.0, highcut=100.0)\n    \n    def notch_filter(self, data: np.ndarray, freq: float = 50.0, \n                     quality: float = 30.0) -> np.ndarray:\n        """\n        Remove power line noise (50/60 Hz).\n        \n        Args:\n            data: Input signal\n            freq: Frequency to remove (Hz)\n            quality: Quality factor (higher = narrower notch)\n            \n        Returns:\n            Filtered signal\n        """\n        nyquist = 0.5 * self.fs\n        w0 = freq / nyquist\n        b, a = signal.iirnotch(w0, quality)\n        filtered = signal.filtfilt(b, a, data)\n        return filtered\n    \n    def remove_artifacts(self, data: np.ndarray, threshold: float = 5.0) -> np.ndarray:\n        """\n        Remove large amplitude artifacts (movement, electrical noise).\n        \n        Args:\n            data: Input signal\n            threshold: Standard deviations from mean to clip\n            \n        Returns:\n            Artifact-removed signal\n        """\n        mean = np.mean(data)\n        std = np.std(data)\n        clipped = np.clip(data, mean - threshold * std, mean + threshold * std)\n        return clipped\n\n\nif __name__ == "__main__":\n    # Demo filtering\n    from src.signal_simulator.hippocampus_sim import HippocampusSimulator\n    \n    sim = HippocampusSimulator()\n    t, signals = sim.generate_memory_encoding_pattern(duration=2.0)\n    \n    filt = NeuralFilter(sampling_rate=1000)\n    theta = filt.extract_theta(signals[0, :])\n    gamma = filt.extract_gamma(signals[0, :])\n    \n    print(f"Original signal RMS: {np.sqrt(np.mean(signals[0]**2)):.3f}")\n    print(f"Theta band RMS: {np.sqrt(np.mean(theta**2)):.3f}")\n    print(f"Gamma band RMS: {np.sqrt(np.mean(gamma**2)):.3f}")\n